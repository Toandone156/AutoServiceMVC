@{
    ViewData["Title"] = "Verify email";
}

<section class="ftco-section contact-section">
    <div class="container mt-5">
        <div class="row justify-content-center mb-5">
            <div class="col-md-7 heading-section text-center ftco-animate">
                <span class="subheading">Verify</span>
                <h2 class="mb-4">Your Email</h2>
            </div>
        </div>
        <div class="row block-9">
            <div class="col-12 ftco-animate">
                <div class="p-3 h4 font-weight-bold">The confirmation email can be in your spam box</div>
            </div>
            <div class="col-12 ftco-animate">
                <div class="form-group mt-2">
                    <button href="@TempData["SendMailAgainURL"]" id="couterbutton" class="btn btn-primary py-3 px-5">
                        Send mail again
                    </button>
                    <a href="https://mail.google.com/mail/u/0/" class="btn btn-primary py-3 px-5" target="_blank" rel="noopener noreferrer">
                        Checking your email
                    </a>
                </div>
            </div>
            <div class="col-md-4"></div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        var sendButton = document.getElementById('couterbutton')
        let i = 30;

        function onTimer() {
            sendButton.innerHTML = i + "s left";
            sendButton.disabled = true;

            i--;
            if (i < 0) {
                clearInterval(i);
                    sendButton.innerHTML = "Send email again";
                sendButton.disabled = false;
            }
            else {
                setTimeout(onTimer, 1000);
            }
        }

        function sendMail(url){
            $.ajax({
                url: url,
                type: 'POST',
                data: {},
                success: function (response) {
                    showToast(response.message)
                },
                error: function (xhr, status, error) {
                    showToast("Fail to send mail")
                }
            });
        }

        onTimer();
        sendButton.addEventListener('click', e => {
            e.preventDefault();
            let url = sendButton.getAttribute("href");
            sendMail(url);

            i = 30;
            onTimer();
        })
    </script>
}
